{% extends "propiedades/base.html" %}
{% load static %}

{% block content %}
    <h2>Editar Perfil</h2>
    <form method="post" novalidate enctype="multipart/form-data">
        {% csrf_token %}

        {# Mostrar errores generales del formulario (no asociados a un campo específico) #}
        {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
                {% for error in form.non_field_errors %}
                    <p class="mb-0">{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <h3>Información del Usuario</h3>
        {% for field in form %}
            {% if field.is_hidden %}
                {{ field }}
            {% else %}
                {% if field.name == 'password' %}
                    {# Si el campo es 'password', mostramos un enlace para cambiarla #}
                    <div class="mb-3">
                        <label class="form-label">Contraseña:</label>
                        <p>Puedes cambiar tu contraseña <a href="{% url 'cambiar_contrasenia' %}">aquí</a>.</p>
                    </div>
                {% else %}
                    {# Para otros campos, usamos las clases de Bootstrap #}
                    <div class="mb-3">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}:</label>
                        {{ field }} {# Esto renderiza el input (o select, textarea) #}

                        {# Mostrar errores específicos del campo #}
                        {% if field.errors %}
                            <div class="invalid-feedback d-block"> {# 'd-block' es importante para que se vea siempre #}
                                {% for error in field.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}

                        {# Ayuda de texto para el campo #}
                        {% if field.help_text %}
                            <div class="form-text">{{ field.help_text }}</div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}

        {# Sección para el Avatar #}
        <h3>Avatar</h3>
        {% if user.is_authenticated and user.avatar %}
            <div class="mb-3">
                <p>Avatar actual:</p>
                <img src="{{ user.avatar.imagen.url }}" alt="Avatar" style="max-width: 150px; max-height: 150px; border-radius: 50%; object-fit: cover;">
            </div>
        {% else %}
            <p>No tienes un avatar asignado.</p>
        {% endif %}
        <div class="mb-3">
            <label for="{{ avatar_form.imagen.id_for_label }}" class="form-label">Subir nuevo Avatar:</label>
            {{ avatar_form.imagen }}
            {% if avatar_form.imagen.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in avatar_form.imagen.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>


        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
    </form>
{% endblock %}